<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CurseStudio Chat</title>
<style>
body { font-family:sans-serif; background:#1e1e2f; color:#fff; margin:0; display:flex; flex-direction:column; height:100vh; }
header { background:#2a2a3f; padding:10px; text-align:center; }
#chat { flex:1; overflow-y:auto; padding:10px; background:#1b1b2a; }
#input { display:flex; }
#input input { flex:1; padding:10px; border:none; }
#input button { padding:10px; border:none; background:#4a4aff; color:#fff; cursor:pointer; }
.message { margin:5px 0; }
.message.admin { color:#ff4a4a; }
</style>
</head>
<body>

<header>
<h1>CurseStudio Chat</h1>
</header>

<div id="chat"></div>

<div id="input">
<input id="msg" placeholder="Mesajınızı yazın..." autocomplete="off">
<button id="send">Gönder</button>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = 'https://<YOUR_SUPABASE_URL>.supabase.co'
const SUPABASE_KEY = '<YOUR_SUPABASE_ANON_KEY>'
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

let username = localStorage.getItem('nick') || prompt("Nick belirleyin:")
localStorage.setItem('nick', username)

const chatEl = document.getElementById('chat')
const inputEl = document.getElementById('msg')
const sendBtn = document.getElementById('send')

// Mesajları çek
async function loadMessages() {
    let { data } = await supabase.from('messages').select('*').order('created_at')
    chatEl.innerHTML = ''
    data.forEach(m => addMessageToDOM(m))
}

// DOM'a ekle
function addMessageToDOM(m) {
    let div = document.createElement('div')
    div.className = 'message' + (m.is_admin ? ' admin':'')
    div.textContent = `${m.username}: ${m.content}`
    chatEl.appendChild(div)
    chatEl.scrollTop = chatEl.scrollHeight
}

// Mesaj gönder
async function sendMessage() {
    if(!inputEl.value) return
    await supabase.from('messages').insert([{ username, content: inputEl.value, is_admin:false }])
    inputEl.value = ''
}

// Dinleme
supabase
  .channel('public:messages')
  .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
      addMessageToDOM(payload.new)
  })
  .subscribe()

sendBtn.onclick = sendMessage
inputEl.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage() })

loadMessages()

// Admin sıfırlama kısayolu
document.addEventListener('keydown', e=>{
    if(e.ctrlKey && e.shiftKey && e.code==='F9'){
        supabase.from('messages').delete().neq('id', 0)
        supabase.from('messages').insert([{username:'CurseBot', content:'Chat Yönetici Tarafından Sıfırlandı', is_admin:true}])
    }
})
</script>

</body>
</html>
