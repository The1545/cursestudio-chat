<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CurseStudio | Ultra V13</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --bg: #36393f; --dark: #2f3136; --v-dark: #202225; --accent: #5865f2; --admin-red: #ff4747; --admin-blue: #00d2ff; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Whitney', 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: #dcddde; height: 100vh; display: flex; overflow: hidden; }
        
        #sidebar, #member-list { width: 240px; background: var(--dark); display: none; flex-direction: column; border: 1px solid #222; }
        #main { flex: 1; display: none; flex-direction: column; position: relative; }
        
        #messages { flex: 1; overflow-y: auto; padding: 20px 0; }
        .msg { padding: 8px 20px; position: relative; }
        .msg:hover { background: rgba(0,0,0,0.05); }
        
        /* Update Button Style */
        #update-notif { 
            display: none; width: 100%; padding: 10px; background: #9b59b6; 
            color: white; border: none; border-radius: 6px; cursor: pointer; 
            font-weight: bold; font-size: 13px; margin-bottom: 10px;
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .msg-tools { position: absolute; right: 20px; top: 5px; display: none; gap: 10px; background: var(--v-dark); padding: 5px 10px; border-radius: 5px; border: 1px solid #444; z-index: 10; }
        .msg:hover .msg-tools { display: flex; }
        .tool-btn { cursor: pointer; font-size: 13px; opacity: 0.8; }
        .tool-btn:hover { opacity: 1; color: var(--accent); }

        .nick { font-weight: 600; cursor: pointer; }
        .nick.kurucu { color: var(--admin-red); }
        .nick.admin-volar { color: var(--admin-blue); }
        .badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; color: white; margin-right: 5px; font-weight: bold; }
        
        .input-wrap { padding: 20px; background: var(--bg); }
        .inner-input { background: #40444b; border-radius: 8px; padding: 12px; display: flex; align-items: center; gap: 10px; }
        #chat-in { background: transparent; border: none; color: white; flex: 1; outline: none; }
        
        #auth-overlay { position: fixed; inset: 0; background: #2f3136; display: flex; align-items: center; justify-content: center; z-index: 3000; }
        .auth-box { text-align: center; background: var(--v-dark); padding: 40px; border-radius: 12px; }
    </style>
</head>
<body>

<div id="auth-overlay"><div class="auth-box"><h2>CurseStudio</h2><input type="text" id="user-nick" placeholder="KullanÄ±cÄ± adÄ±nÄ±z..." style="width:300px; padding:14px; background:#36393f; border:1px solid #111; color:white; border-radius:5px; margin-bottom:20px;"><br><button onclick="login()" style="width:300px; padding:15px; background:var(--accent); color:white; border:none; border-radius:6px; font-weight:bold; cursor:pointer;">GÄ°RÄ°Åž YAP</button></div></div>

<div id="sidebar">
    <div style="padding:15px; font-weight:bold; border-bottom:1px solid #222">CurseStudio</div>
    <div id="chan-list" style="flex:1"></div>
    <div style="padding:15px; border-top:1px solid #222">
        <button id="update-notif" onclick="location.reload()">âœ¨ Yeni SÃ¼rÃ¼m Mevcut! YÃ¼kle</button>
        <button onclick="startSharing()" style="width:100%; padding:10px; background:var(--accent); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold">ðŸ“º EkranÄ± PaylaÅŸ</button>
    </div>
</div>

<div id="main">
    <div id="messages"></div>
    <div class="input-wrap">
        <div class="inner-input">
            <label for="f-up" style="cursor:pointer; color:gray">+</label>
            <input type="file" id="f-up" style="display:none" onchange="handleFile(this.files[0])">
            <input type="text" id="chat-in" placeholder="Mesaj yaz..." onkeypress="if(event.key==='Enter') handleSend()">
        </div>
    </div>
</div>

<div id="member-list">
    <div style="padding:20px; font-size:12px; font-weight:bold; color:gray">AKTÄ°F ÃœYELER</div>
    <div id="members-ui" style="padding:0 10px"></div>
</div>

<script>
// --- VERSÄ°YON AYARI ---
const CURRENT_VERSION = "1.0"; // Her kod deÄŸiÅŸtirdiÄŸinde burayÄ± artÄ±r (Ã¶rn: 1.1)
// ----------------------

const firebaseConfig = {
    apiKey: "AIzaSyCnoxoPsUFx3f71SAcV7vd5ex_ZUmOk3e0",
    authDomain: "cursestudio-chat.firebaseapp.com",
    databaseURL: "https://cursestudio-chat-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "cursestudio-chat",
    storageBucket: "cursestudio-chat.appspot.com",
    messagingSenderId: "6190203668",
    appId: "1:6190203668:web:bb7475428ab3f96c62b801"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myNick = "", activeC = "genel";
const KURUCU = "The1545", ADMIN = "Volar";

function login() {
    myNick = document.getElementById('user-nick').value.trim();
    if(!myNick) return;
    document.getElementById('auth-overlay').style.display = "none";
    document.getElementById('sidebar').style.display = "flex";
    document.getElementById('main').style.display = "flex";
    document.getElementById('member-list').style.display = "flex";
    
    db.ref('presence/' + myNick).set(true);
    db.ref('presence/' + myNick).onDisconnect().remove();
    
    // Versiyon KontrolÃ¼nÃ¼ BaÅŸlat
    checkVersion();
    initChat();
}

function checkVersion() {
    // VeritabanÄ±ndaki versiyonu dinle
    db.ref('app_settings/version').on('value', snap => {
        const cloudVersion = snap.val();
        if (cloudVersion && cloudVersion !== CURRENT_VERSION) {
            document.getElementById('update-notif').style.display = "block";
        } else {
            document.getElementById('update-notif').style.display = "none";
        }
    });

    // EÄŸer Kurucu isen, mevcut versiyonu veritabanÄ±na iÅŸle
    if (myNick === KURUCU) {
        db.ref('app_settings/version').set(CURRENT_VERSION);
    }
}

function handleSend() {
    const el = document.getElementById('chat-in');
    const m = el.value.trim();
    if(!m) return;
    db.ref('msgs/' + activeC).push({ n: myNick, m: m, t: Date.now() });
    el.value = "";
}

function initChat() {
    db.ref('msgs/' + activeC).on('value', snap => {
        const box = document.getElementById('messages');
        box.innerHTML = "";
        snap.forEach(child => {
            const d = child.val();
            const id = child.key;
            const div = document.createElement('div');
            div.className = "msg";
            const isK = d.n === KURUCU, isA = d.n === ADMIN;
            const isStaff = (myNick === KURUCU || myNick === ADMIN);
            
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between">
                    <div>
                        ${isK?'<span class="badge" style="background:var(--admin-red)">KURUCU</span>':isA?'<span class="badge" style="background:var(--admin-blue)">YÃ–NETÄ°CÄ°</span>':''}
                        <span class="nick ${isK?'kurucu':isA?'admin-volar':''}">${d.n}</span>
                        <span style="color:gray; font-size:10px">${new Date(d.t).toLocaleTimeString()}</span>
                        <div style="margin-top:4px">${d.m}</div>
                    </div>
                    <div class="msg-tools">
                        ${(d.n === myNick || isStaff) ? `<span class="tool-btn" style="color:red" onclick="deleteMsg('${id}')">ðŸ—‘ Sil</span>` : ''}
                    </div>
                </div>`;
            box.appendChild(div);
        });
        box.scrollTop = box.scrollHeight;
    });

    db.ref('presence').on('value', s => {
        const ui = document.getElementById('members-ui'); ui.innerHTML = "";
        Object.keys(s.val() || {}).forEach(u => {
            const isK = u === KURUCU, isA = u === ADMIN;
            ui.innerHTML += `<div style="margin-bottom:8px"><span class="nick ${isK?'kurucu':isA?'admin-volar':''}">${u}</span></div>`;
        });
    });
}

function deleteMsg(id) {
    if(confirm("Silinsin mi?")) db.ref('msgs/' + activeC + '/' + id).remove();
}

function handleFile(f) {
    if(!f) return;
    const r = new FileReader();
    r.onload = e => db.ref('msgs/' + activeC).push({ n: myNick, m: "ðŸ“· FotoÄŸraf gÃ¶nderildi", img: e.target.result, t: Date.now() });
    r.readAsDataURL(f);
}

async function startSharing() {
    try {
        await navigator.mediaDevices.getDisplayMedia({video:true});
        db.ref('msgs/' + activeC).push({n: myNick, m: "ðŸ“º Ekran paylaÅŸÄ±mÄ± baÅŸlattÄ±!", t: Date.now()});
    } catch(e) {}
}
</script>
</body>
</html>