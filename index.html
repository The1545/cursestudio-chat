<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CurseStudio | Global Chat</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { 
            --bg: #36393f; --dark: #2f3136; --v-dark: #202225; --accent: #5865f2; 
            --admin-red: #ff4747; --admin-orange: #ff9f43; --bot-green: #2ecc71;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: #dcddde; height: 100vh; display: flex; overflow: hidden; }
        
        /* Auth Screen */
        #auth-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .box { background: var(--dark); padding: 40px; border-radius: 8px; width: 350px; text-align: center; border: 1px solid #444; }
        input[type="text"] { width: 100%; padding: 12px; background: var(--v-dark); border: 1px solid #111; color: white; border-radius: 4px; margin-bottom: 20px; outline: none; }
        .btn { width: 100%; padding: 15px; border: none; background: var(--accent); color: white; font-weight: bold; cursor: pointer; border-radius: 4px; }

        /* Sidebar */
        #sidebar { width: 260px; background: var(--dark); border-right: 1px solid var(--v-dark); display: none; flex-direction: column; }
        .channel-btn { padding: 12px 20px; cursor: pointer; color: #8e9297; font-weight: 500; }
        .channel-btn:hover { background: #3c3f44; color: #fff; }
        .channel-btn.active { background: #4f545c; color: #fff; border-left: 4px solid var(--accent); }

        /* Main Chat */
        #main { flex: 1; display: none; flex-direction: column; }
        #messages { flex: 1; overflow-y: auto; padding: 25px; scroll-behavior: smooth; }
        
        .msg { margin-bottom: 18px; border-bottom: 1px solid rgba(255,255,255,0.02); padding-bottom: 8px; }
        .nick { font-weight: bold; margin-right: 8px; }
        .nick.kurucu { color: var(--admin-red) !important; text-shadow: 0 0 8px rgba(255,71,71,0.4); }
        .nick.admin-volar { color: var(--admin-orange) !important; text-shadow: 0 0 8px rgba(255,159,67,0.4); }
        .nick.bot { color: var(--bot-green) !important; }
        
        .badge { font-size: 10px; padding: 2px 6px; border-radius: 3px; font-weight: bold; color: white; margin-right: 8px; text-transform: uppercase; }
        .badge-red { background: var(--admin-red); }
        .badge-orange { background: var(--admin-orange); }
        .badge-green { background: var(--bot-green); }
        .time { font-size: 11px; color: #72767d; }
        .text { margin-top: 5px; color: #dcddde; word-break: break-word; }

        .input-wrap { padding: 20px; background: var(--bg); }
        .inner-input { background: #40444b; border-radius: 8px; padding: 12px; display: flex; }
        #chat-in { background: transparent; border: none; color: white; flex: 1; outline: none; font-size: 15px; }
        #chat-in:disabled { opacity: 0.3; cursor: not-allowed; }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="box">
        <h2 style="color:white; margin-bottom:10px;">CURSE STUDIO</h2>
        <input type="text" id="user-nick" placeholder="KullanÄ±cÄ± adÄ±nÄ±z..." maxlength="15">
        <button class="btn" onclick="startWithoutAuth()">BAÄžLAN</button>
    </div>
</div>

<div id="sidebar">
    <div style="padding:25px 20px; font-weight:bold; color:white; font-size:18px; letter-spacing:1px;">CURSE STUDIO</div>
    <div class="channel-btn active" id="btn-genel" onclick="changeChannel('genel')"># genel-sohbet</div>
    <div class="channel-btn" id="btn-duyurular" onclick="changeChannel('duyurular')">ðŸ“¢ duyurular</div>
    <div style="margin-top:auto; padding:20px; border-top:1px solid #222; font-size:12px; color:#f04747; cursor:pointer;" onclick="location.reload()">Ã‡Ä±kÄ±ÅŸ Yap</div>
</div>

<div id="main">
    <div id="messages"></div>
    <div class="input-wrap">
        <div class="inner-input">
            <input type="text" id="chat-in" placeholder="Mesaj yazÄ±n..." onkeypress="if(event.key==='Enter') send()">
        </div>
    </div>
</div>

<script>
// KONFÄ°GÃœRASYON AYNI KALDI
const firebaseConfig = {
    apiKey: "AIzaSyCnoxoPsUFx3f71SAcV7vd5ex_ZUmOk3e0",
    authDomain: "cursestudio-chat.firebaseapp.com",
    databaseURL: "https://cursestudio-chat-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "cursestudio-chat",
    storageBucket: "cursestudio-chat.appspot.com",
    messagingSenderId: "6190203668",
    appId: "1:6190203668:web:bb7475428ab3f96c62b801"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myNick = "";
let currentChannel = "genel";
const KURUCU = "The1545";
const ADMIN = "Volar";

// AUTH KULLANMADAN DÄ°REKT BAÅžLATMA
function startWithoutAuth() {
    const n = document.getElementById('user-nick').value.trim();
    if(!n) return alert("Ä°sim yazmalÄ±sÄ±n!");
    myNick = n;
    
    document.getElementById('auth-overlay').style.display = "none";
    document.getElementById('sidebar').style.display = "flex";
    document.getElementById('main').style.display = "flex";
    changeChannel('genel');
}

function changeChannel(chan) {
    currentChannel = chan;
    document.getElementById('btn-genel').classList.toggle('active', chan === 'genel');
    document.getElementById('btn-duyurular').classList.toggle('active', chan === 'duyurular');
    document.getElementById('messages').innerHTML = "";
    
    const input = document.getElementById('chat-in');
    const hasPower = (myNick === KURUCU || myNick === ADMIN);
    
    if(chan === 'duyurular' && !hasPower) {
        input.disabled = true;
        input.placeholder = "Bu kanala sadece yetkililer yazabilir.";
    } else {
        input.disabled = false;
        input.placeholder = "#" + chan + " kanalÄ±na mesaj yaz...";
    }

    db.ref('messages/' + chan).off();
    db.ref('messages/' + chan).on('value', snap => {
        document.getElementById('messages').innerHTML = "";
        snap.forEach(child => {
            renderMessage(child.val());
        });
    });
}

function send() {
    const input = document.getElementById('chat-in');
    const val = input.value.trim();
    if(!val || input.disabled) return;

    if(val === "/clear") {
        if(myNick === KURUCU || myNick === ADMIN) {
            db.ref('messages/' + currentChannel).remove().then(() => {
                db.ref('messages/' + currentChannel).push({
                    n: "CurseBot",
                    m: "Sohbet bir yetkili tarafÄ±ndan temizlendi.",
                    t: Date.now(),
                    isBot: true
                });
            });
            input.value = "";
            return;
        }
    }

    db.ref('messages/' + currentChannel).push({
        n: myNick,
        m: val,
        t: Date.now()
    });
    input.value = "";
}

function renderMessage(data) {
    const box = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = "msg";
    
    let nickClass = "";
    let badge = "";
    
    if(data.isBot) {
        nickClass = "bot";
        badge = '<span class="badge badge-green">SYSTEM</span>';
    } else if(data.n === KURUCU) {
        nickClass = "kurucu";
        badge = '<span class="badge badge-red">KURUCU</span>';
    } else if(data.n === ADMIN) {
        nickClass = "admin-volar";
        badge = '<span class="badge badge-orange">ADMÄ°N</span>';
    }

    const time = data.t ? new Date(data.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : "";
    
    div.innerHTML = `
        <div>
            ${badge}<span class="nick ${nickClass}">${data.n}</span>
            <span class="time">${time}</span>
        </div>
        <div class="text">${escapeHtml(data.m)}</div>
    `;
    
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}

function escapeHtml(t) {
    const d = document.createElement('div');
    d.textContent = t;
    return d.innerHTML;
}
</script>
</body>
</html>