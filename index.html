<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CurseStudio Chat</title>
<style>
  body { font-family: Arial; margin:0; background:#1e1e2f; color:#fff; display:flex; flex-direction:column; height:100vh; }
  #login { display:flex; flex-direction:column; align-items:center; justify-content:center; flex:1; }
  #chat { display:none; flex-direction:column; flex:1; }
  #messages { flex:1; overflow-y:auto; padding:10px; background:#2e2e44; }
  #input { display:flex; }
  input { flex:1; padding:10px; border:none; border-radius:5px 0 0 5px; }
  button { padding:10px; border:none; background:#4caf50; color:#fff; border-radius:0 5px 5px 0; cursor:pointer; margin-top:5px; }
  .message { margin-bottom:5px; }
  .announcement { color:#ffcc00; font-weight:bold; }
  #channels { display:flex; background:#111133; }
  .channel { flex:1; text-align:center; padding:5px; cursor:pointer; }
  .active { background:#333366; }
  #login button { width:200px; }
</style>
</head>
<body>

<div id="login">
  <h2>CurseStudio Chat</h2>
  <input type="text" id="nick" placeholder="Nick yaz">
  <button id="loginBtn">Giriş Yap</button>
  <button id="skipBtn">Skip / Random Nick</button>
</div>

<div id="chat">
  <div id="channels">
    <div class="channel active" data-name="chat">#chat</div>
    <div class="channel" data-name="announcement">#duyuru</div>
  </div>
  <div id="messages"></div>
  <div id="input">
    <input type="text" id="msg" placeholder="Mesaj yaz...">
    <button id="sendBtn">Gönder</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCnoxoPsUFx3f71SAcV7vd5ex_ZUmOk3e0",
    authDomain: "cursestudio-chat.firebaseapp.com",
    databaseURL: "https://cursestudio-chat-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "cursestudio-chat",
    storageBucket: "cursestudio-chat.firebasedestorage.app",
    messagingSenderId: "6190203668",
    appId: "1:6190203668:web:bb7475428ab3f96c62b801"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const loginDiv = document.getElementById('login');
  const chatDiv = document.getElementById('chat');
  const nickInput = document.getElementById('nick');
  const loginBtn = document.getElementById('loginBtn');
  const skipBtn = document.getElementById('skipBtn');

  let nick = '';

  function enterChat(userNick) {
    nick = userNick;
    loginDiv.style.display='none';
    chatDiv.style.display='flex';
    localStorage.setItem('nick', nick);
    initChat();
  }

  loginBtn.onclick = () => {
    const val = nickInput.value.trim();
    if(val) enterChat(val);
    else alert('Nick girmelisin veya Skip basabilirsin');
  };

  skipBtn.onclick = () => {
    const randomNick = `User${Math.floor(Math.random()*9999)}`;
    enterChat(randomNick);
  };

  const channels = document.querySelectorAll('.channel');
  let activeChannel = 'chat';
  channels.forEach(ch => {
    ch.onclick = () => {
      channels.forEach(c=>c.classList.remove('active'));
      ch.classList.add('active');
      activeChannel = ch.dataset.name;
      loadMessages();
    }
  });

  const messagesDiv = document.getElementById('messages');
  const msgInput = document.getElementById('msg');
  const sendBtn = document.getElementById('sendBtn');

  function initChat() {
    loadMessages();
    sendBtn.onclick = sendMessage;
    msgInput.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });

    document.addEventListener('keydown', e => {
      if(e.ctrlKey && e.shiftKey && e.key==='F9') {
        localStorage.clear();
        push(ref(db,'announcement'), {nick:'CurseBot', text:'Chat Yönetici Tarafından Sıfırlandı', time:Date.now()});
        messagesDiv.innerHTML='';
      }
    });
  }

  function sendMessage() {
    const text = msgInput.value.trim();
    if(!text) return;
    if(activeChannel==='announcement') return;
    push(ref(db, activeChannel), {nick,text,time:Date.now()});
    msgInput.value='';
  }

  function loadMessages() {
    messagesDiv.innerHTML='';
    const dbRef = ref(db, activeChannel);
    onChildAdded(dbRef, snapshot => {
      const data = snapshot.val();
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message');
      if(activeChannel==='announcement') msgDiv.classList.add('announcement');
      msgDiv.textContent = `[${new Date(data.time).toLocaleTimeString()}] ${data.nick}: ${data.text}`;
      messagesDiv.appendChild(msgDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  }

</script>
</body>
</html>
